# -*- coding: utf-8 -*-
# Copyright (c) Dexter Le (dextersydney2001@gmail.com)
# GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

---
anchors:
  environ: &env-def {environ_update: {LANGUAGE: C, LC_ALL: C}, check_rc: true}
test_cases:
- id: test_missing_input
  input: {}
  output:
    failed: true
    msg: "missing required arguments: name"
- id: test_invalid_state
  input:
    state: abcd
    name: virtual-ip
  output:
    failed: true
    msg: "value of state must be one of: present, absent, got: abcd"
- id: test_present_minimal_input_resource_not_exist
  input:
    state: present
    name: virtual-ip
    resource_type:
      resource_name: IPaddr2
    resource_option:
      - "ip=[192.168.999.5]"
  output:
    out: []
  mocks:
    run_command:
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 1
      out: ""
      err: ""
    - command: [pcs, resource, create, virtual-ip, IPaddr2, "ip=[192.168.999.5]", "--wait=300"]
      environ: *env-def
      rc: 0
      out: ""
      err: ""
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 0
      out: ""
      err: ""
- id: test_present_minimal_input_resource_failed_creation
  input:
    state: present
    name: virtual-ip
    resource_type:
      resource_name: IPaddr2
    resource_option:
      - "ip=[192.168.999.5]"
  output: {}
  mocks:
    run_command:
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 1
      out: ""
      err: ""
    - command: [pcs, resource, create, virtual-ip, IPaddr2, "ip=[192.168.999.5]", "--wait=300"]
      environ: *env-def
      rc: 1
      out: ""
      err: "Assumed agent name 'ocf:heartbeat:IPaddr2' (deduced from 'IPaddr2')
            Waiting for the cluster to apply configuration changes (timeout: 300 seconds)...
            Error: resource 'virtual-ip' is not running on any node
            Error: Errors have occurred, therefore pcs is unable to continue"
- id: test_absent_minimal_input_resource_not_exist
  input:
    state: absent
    name: virtual-ip
  output:
    out: []
  mocks:
    run_command:
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 1
      out: ""
      err: ""
- id: test_absent_minimal_input_resource_exist
  input:
    state: absent
    name: virtual-ip
  output:
    out: []
  mocks:
    run_command:
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 0
      out: ""
      err: ""
    - command: [pcs, resource, delete, virtual-ip]
      environ: *env-def
      rc: 0
      out: ""
      err: ""
    - command: [pcs, resource, status, virtual-ip]
      environ: *env-def
      rc: 1
      out: ""
      err: ""
