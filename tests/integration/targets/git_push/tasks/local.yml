- name: FILE | set first random file name.
  set_fact:
    file1: "{{ lookup('pipe','date +%s%N') }}.txt"

- name: FILE | set second random file name.
  set_fact:
    file2: "{{ lookup('pipe','date +%s%N') }}.txt"

- name: FILE | touch file1 and file2
  file:
    path: "{{ playbook_dir }}/test_directory/repo/{{ item }}"
    state: touch
  loop:
    - "{{ file1 }}"
    - "{{ file2 }}"

- name: LOCAL +add +mode
  register: result
  git_commit:
    folder_path: "{{ playbook_dir }}/test_directory/repo"
    comment: Add file1 and file2
    add: [ "{{ file1 }}", "{{ file2 }}" ]
    mode: local
    url: "{{ playbook_dir }}/test_directory/repo.git"

- assert: { that: "result.changed == true" }

- name: LOCAL push on master
  register: result
  git_push:
    folder_path: "{{ playbook_dir }}/test_directory/repo"
    branch: master
    mode: local
    url: "{{ playbook_dir }}/test_directory/repo.git"

- assert: { that: "result.changed == true" }

- name: FILE | rm file1 and file2
  file:
    path: "{{ playbook_dir }}/test_directory/repo/{{ item }}"
    state: absent
  loop:
    - "{{ file1 }}"
    - "{{ file2 }}"

- name: LOCAL -add +mode
  register: result
  git_commit:
    folder_path: "{{ playbook_dir }}/test_directory/repo"
    comment: Add .
    mode: local
    url: "{{ playbook_dir }}/test_directory/repo.git"

- assert: { that: "result.changed == true" }

- name: LOCAL push on master
  register: result
  git_push:
    folder_path: "{{ playbook_dir }}/test_directory/repo"
    branch: master
    mode: local
    url: "{{ playbook_dir }}/test_directory/repo.git"

- assert: { that: "result.changed == true" }
