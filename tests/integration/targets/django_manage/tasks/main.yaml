# Test code for django_manage module
#
# Copyright: (c) 2020, Alexei Znamensky <russoz@gmail.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)
- name: Install required library
  pip:
    name: django
    state: present

- name: Create temporary test directory
  tempfile:
    state: directory
    suffix: .django_manage
  register: tmp_django_root

- name: Create project
  command:
    chdir: "{{ tmp_django_root.path }}"
    cmd: django-admin startproject test_django_manage_1

- name: Create app
  command:
    chdir: "{{ tmp_django_root.path }}"
    cmd: django-admin startapp app1

- name: Check
  community.general.django_manage:
    project_path: "{{ tmp_django_root.path }}/test_django_manage_1"
    command: check

- name: Remove temporaty files
  file:
    path: "{{ tmp_django_root.path }}"
    state: absent
