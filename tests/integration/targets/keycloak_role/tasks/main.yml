---
- name: Delete realm
  community.general.keycloak_realm: "{{ auth_args | combine(call_args) }}"
  vars:
    call_args:
      id: "{{ realm }}"
      realm: "{{ realm }}"
      state: absent

- name: Create realm
  community.general.keycloak_realm: "{{ auth_args | combine(call_args) }}"
  vars:
    call_args:
      id: "{{ realm }}"
      realm: "{{ realm }}"
      state: present

- name: Create client
  community.general.keycloak_client: "{{ auth_args | combine(call_args) }}"
  vars:
    call_args:
      realm: "{{ realm }}"
      client_id: "{{ client_id }}"
      state: present
  register: client

- include_tasks: create_update_delete_tests.yml
  vars:
    test_props: "{{ item }}"
  loop:
    - test_name: "1. Realm role test"
      expect_to_be_realm: true
      create_args:
        name: "{{ role }}"
        description: "{{ description_1 }}"
      update_args:
        name: "{{ role }}"
        description: "{{ description_2 }}"
         
    - test_name: "2. Client role test"
      expect_to_be_realm: false
      create_args:
        name: "{{ role }}"
        client_id: "{{ client_id }}"        
        description: "{{ description_1 }}"
      update_args:
        name: "{{ role }}"
        client_id: "{{ client_id }}"        
        description: "{{ description_2 }}"
