---

test_case:
  - id: "(00) presence of changes"
    base: {A: {AA: '1'}, B: ['2', '3'], C: '4'}
    changes: {A: {AB: '9'}, B: ['8', '2'], C: '7'}
    present: true
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: {A: {AA: '1', AB: '9'}, B: ['2', '3', '8'], 'C': '7'}
  - id: "(01) absence of changes"
    base: {A: {AA: '1', AB: '2'}, B: ['3', '4'], C: '5'}
    changes: {A: {AA: '1'}, B: ['3', '9'], C: '8'}
    present: false
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: {A: {AB: '2'}, B: ['4'], C: '5'}
  - id: "(10) list as list changes present"
    base: ['A', 'B', {C: '1', D: '2'}, {E: '3'}]
    changes: ['Z', 'B', {C: '1'}, {E: '3'}]
    present: true
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: ['A', 'B', {C: '1', D: '2'}, {E: '3'}, 'Z', {C: '1'}]
  - id: "(11) list as list changes absent"
    base: ['A', 'B', {C: '1', D: '2'}, {E: '3'}]
    changes: ['Z', 'B', {C: '1'}, {E: '3'}]
    present: false
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: ['A', {C: '1', D: '2'}]
  - id: "(12) list as dict changes present"
    base: ['A', 'B', {C: '1', D: '2'}, {E: '3'}]
    changes: ['Z', 'B', {C: '9', D: '2'}, {E: '3'}]
    present: true
    list_as_dict: true
    keep_empty: false
    remove_null: false
    expected: ['Z', 'B', {C: '9', D: '2'}, {E: '3'}]
  - id: "(13) list as dict changes absent"
    base: ['A', 'B', {C: '1', D: '2'}, {E: '3'}]
    changes: ['Z', 'B', {C: '9', D: '2'}, {E: '3'}]
    present: false
    list_as_dict: true
    keep_empty: false
    remove_null: false
    expected: ['A', {C: '1'}]
  - id: "(20) not keep empty structure"
    base: {A: {AA: '1'}, B: ['2', '3'], C: '4'}
    changes: {A: {AA: '1'}, B: ['2', '3']}
    present: false
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: {C: '4'}
  - id: "(21) keep empty structure"
    base: {A: {AA: '1'}, B: ['2', '3'], C: '4'}
    changes: {A: {AA: '1'}, B: ['2', '3']}
    present: false
    list_as_dict: false
    keep_empty: true
    remove_null: false
    expected: {A: {}, B: [], C: '4'}
  - id: "(30) null are ignored when present"
    base: ['A', 'B', 'C', {DA: '1', DB: '2'}, 'E']
    changes: [null, null, 'Z', {DA: '1', DB: null}, 'E']
    present: true
    list_as_dict: true
    keep_empty: false
    remove_null: false
    expected: ['A', 'B', 'Z', {DA: '1', DB: '2'}, 'E']
  - id: "(31) null are ignored when not present"
    base: ['A', 'B', 'C', {DA: '1', DB: '2'}, 'E']
    changes: [null, null, 'Z', {DA: '1', DB: null}, 'E']
    present: false
    list_as_dict: true
    keep_empty: false
    remove_null: false
    expected: ['A', 'B', 'C', {DB: '2'}]
  - id: "(32) use remove_null"
    base: {A: '1', B: '2', C: {CA: '3', CB: '4'}, D: ['DA', 'DB']}
    changes: {B: null, C: {CB: null}, D: null}
    present: false
    list_as_dict: true
    keep_empty: false
    remove_null: true
    expected: {A: '1', C: {CA: '3'}}
  - id: "(90) ensure it can run with complex Ansible core object"
    base: "{{ ansible_facts['ansible_local'] }}"
    changes: {unprobable_key: "that can not exists"}
    present: false
    list_as_dict: false
    keep_empty: false
    remove_null: false
    expected: "{{ ansible_facts['ansible_local'] }}"
