- name: create a new directory for file source
  file: dest="{{output_dir}}/src" state=directory
  register: result
- name: assert the directory was created
  assert:
    that:
    - result.state == 'directory'
- name: copy the files to a new directory
  copy: src="./" dest="{{output_dir}}/src"
  register: result
- name: create unicode file for test
  shell: echo "π" > {{ output_dir }}/src/ßΩ.txt
  register: result
- name: assert that the new file was created
  assert:
    that:
    - result.changed == true
- name: test assemble with all fragments
  assemble: src="{{output_dir}}/src" dest="{{output_dir}}/assembled1"
  register: result
- name: assert the fragments were assembled
  assert:
    that:
    - result.state == 'file'
    - result.changed == True
    - result.checksum == '74152e9224f774191bc0bedf460d35de86ad90e6'
- name: test assemble with all fragments
  assemble: src="{{output_dir}}/src" dest="{{output_dir}}/assembled1"
  register: result
- name: assert that the same assemble made no changes
  assert:
    that:
    - result.state == 'file'
    - result.changed == False
    - result.checksum == '74152e9224f774191bc0bedf460d35de86ad90e6'
- name: test assemble with fragments matching a regex
  assemble: src="{{output_dir}}/src" dest="{{output_dir}}/assembled2" regexp="^fragment[1-3]$"
  register: result
- name: assert the fragments were assembled with a regex
  assert:
    that:
    - result.state == 'file'
    - result.checksum == 'edfe2d7487ef8f5ebc0f1c4dc57ba7b70a7b8e2b'
- name: test assemble with a delimiter
  assemble: src="{{output_dir}}/src" dest="{{output_dir}}/assembled3" delimiter="#---
    delimiter ---#"
  register: result
- name: assert the fragments were assembled with a delimiter
  assert:
    that:
    - result.state == 'file'
    - result.checksum == 'd986cefb82e34e4cf14d33a3cda132ff45aa2980'
- name: test assemble with remote_src=False
  assemble: src="./" dest="{{output_dir}}/assembled4" remote_src=no
  register: result
- name: assert the fragments were assembled without remote
  assert:
    that:
    - result.state == 'file'
    - result.checksum == '048a1bd1951aa5ccc427eeb4ca19aee45e9c68b3'
- name: test assemble with remote_src=False and a delimiter
  assemble: src="./" dest="{{output_dir}}/assembled5" remote_src=no delimiter="#---
    delimiter ---#"
  register: result
- name: assert the fragments were assembled without remote
  assert:
    that:
    - result.state == 'file'
    - result.checksum == '505359f48c65b3904127cf62b912991d4da7ed6d'
