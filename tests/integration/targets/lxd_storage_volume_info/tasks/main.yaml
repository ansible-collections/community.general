####################################################################
# WARNING: These are designed specifically for Ansible tests       #
# and should not be used as examples of how to write Ansible roles #
####################################################################

# Copyright (c) Ansible project
# GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

- name: Get information about all volumes in default pool
  community.general.lxd_storage_volume_info:
    pool: default
  register: volume_info_all
  ignore_errors: true

- name: Verify volumes information was retrieved
  assert:
    that:
      - volume_info_all is not changed
      - volume_info_all.storage_volumes is defined
      - volume_info_all.storage_volumes is iterable
  when: volume_info_all is not failed

- name: Test filtering by volume type (custom)
  community.general.lxd_storage_volume_info:
    pool: default
    type: custom
  register: volume_info_custom
  ignore_errors: true

- name: Verify type filtering works
  assert:
    that:
      - volume_info_custom is not changed
      - volume_info_custom.storage_volumes is defined
      - volume_info_custom.storage_volumes is iterable
  when: volume_info_custom is not failed

- name: Test filtering by volume type (container)
  community.general.lxd_storage_volume_info:
    pool: default
    type: container
  register: volume_info_container
  ignore_errors: true

- name: Verify container type filtering works
  assert:
    that:
      - volume_info_container is not changed
      - volume_info_container.storage_volumes is defined
  when: volume_info_container is not failed

- name: Test with non-existent pool (should fail)
  community.general.lxd_storage_volume_info:
    pool: nonexistent-pool-12345
  register: volume_info_nonexistent_pool
  ignore_errors: true

- name: Verify error handling for non-existent pool
  assert:
    that:
      - volume_info_nonexistent_pool is failed

- name: Test with non-existent volume name (should fail)
  community.general.lxd_storage_volume_info:
    pool: default
    name: nonexistent-volume-12345
  register: volume_info_nonexistent_volume
  ignore_errors: true

- name: Verify error handling for non-existent volume
  assert:
    that:
      - volume_info_nonexistent_volume is failed
  when: volume_info_nonexistent_volume is defined

- name: Test check mode
  community.general.lxd_storage_volume_info:
    pool: default
  check_mode: true
  register: volume_info_check
  ignore_errors: true

- name: Verify check mode works
  assert:
    that:
      - volume_info_check is not changed
      - volume_info_check.storage_volumes is defined
  when: volume_info_check is not failed
