# -*- coding: utf-8 -*-
# (c) 2022, Alexei Znamensky
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

- name: test msimple set aa value
  cmd_echo:
    arg_formats:
      aa:
        func: as_opt_eq_val
        args: [--answer]
      bb:
        func: as_bool
        args: [--bb-here]
    arg_order: ['aa', 'bb']
    arg_values:
      bb: true
    aa: 11
  register: msimple_set_aa

- name: assert msimple set aa value
  assert:
    that:
      - msimple_set_aa.rc == 0
      - msimple_set_aa.out == "-- --answer=11 --bb-here\n"
      - msimple_set_aa.err == ""


- name: test msimple default aa value
  cmd_echo:
    arg_formats:
      aa:
        func: as_opt_eq_val
        args: [--answer]
      bb:
        func: as_bool
        args: [--bb-here]
    arg_order: ['aa', 'bb']
    arg_values:
      aa: 43
      bb: true
  register: msimple_default_aa_value

- name: assert msimple default aa value
  assert:
    that:
      - msimple_default_aa_value.rc == 0
      - msimple_default_aa_value.out == "-- --answer=43 --bb-here\n"
      - msimple_default_aa_value.err == ""


- name: test msimple implicit aa format
  cmd_echo:
    arg_formats:
      bb:
        func: as_bool
        args: [--bb-here]
    arg_order: ['aa', 'bb']
    arg_values:
      bb: true
    aa: 1984
  register: msimple_implicit_aa_format

- name: assert msimple implicit aa format
  assert:
    that:
      - msimple_implicit_aa_format.rc == 0
      - msimple_implicit_aa_format.out == "-- --aa 1984 --bb-here\n"
      - msimple_implicit_aa_format.err == ""


- name: test msimple missing bb format
  cmd_echo:
    arg_order: ['aa', 'bb']
    arg_values:
      bb: true
    aa: 1984
  register: msimple_missing_bb_format
  ignore_errors: true

- name: assert msimple missing bb format
  assert:
    that:
      - msimple_missing_bb_format is failed
      - msimple_missing_bb_format.rc == 1
      - '"out" not in msimple_missing_bb_format'
      - '"err" not in msimple_missing_bb_format'
      - >-
        "MissingArgumentFormat: Cannot find format for parameter bb"
        in msimple_missing_bb_format.module_stderr


- name: test msimple missing bb value
  cmd_echo:
    arg_formats:
      bb:
        func: as_bool
        args: [--bb-here]
    arg_order: ['aa', 'bb']
    aa: 1984
  register: msimple_missing_bb_value
  ignore_errors: true

- name: assert msimple missing bb value
  assert:
    that:
      - msimple_missing_bb_value is failed
      - msimple_missing_bb_value.rc == 1
      - '"out" not in msimple_missing_bb_value'
      - '"err" not in msimple_missing_bb_value'
      - >-
        "MissingArgumentValue: Cannot find value for parameter bb"
        in msimple_missing_bb_value.module_stderr
