---
# Copyright (c) 2025, Tom Hesse <contact@tomhesse.xyz>
# GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

- name: Ensure disk files exists
  ansible.builtin.command:
    cmd: "dd if=/dev/zero of={{ item.file }} bs=1M count=256 conv=fsync"
    creates: "{{ item.file }}"
  loop: "{{ zpool_disk_configs }}"

- name: Setup loop devices
  ansible.builtin.command:
    cmd: "losetup {{ item.loop }} {{ item.file }}"
    creates: "{{ item.loop }}"
  loop: "{{ zpool_disk_configs }}"
